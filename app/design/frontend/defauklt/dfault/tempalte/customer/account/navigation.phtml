<?php
/**
 * Magento Enterprise Edition
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Enterprise Edition License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.magentocommerce.com/license/enterprise-edition
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2014 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://www.magentocommerce.com/license/enterprise-edition
 */
?>
<div class="block block-account">
    <!--div class="block-title">
        <strong><span><?php echo $this->__('My Account'); ?></span></strong>
    </div-->
	<?php
			$customer = Mage::getSingleton('customer/session')->getCustomer();
			$nonAdmincustGroupId = Mage::helper('customeraccount')->getNonAdminGroup()->getId();
			$attribute = Mage::getModel('eav/config')->getAttribute('customer','featureaccess');
			$options = $attribute->getSource()->getAllOptions();
			$featureAccess = array();		
			$custFeatureAccess = array();
			$custFeatureAccessArray = explode(',',$customer['featureaccess']);			
			foreach($options as $option){
				$featureAccess[$option['value']] = $option['label'];
			}
			foreach($custFeatureAccessArray as $key => $val) {
				$custFeatureAccess[] = $featureAccess[$val];
			}
	?>
    <div class="block-content">
        <ul class="nav nav-list section-nav">
            <?php $_links = $this->getLinks(); ?>
            <?php $_index = 1; ?>
            <?php $_count = count($_links); ?>
            <?php foreach ($_links as $_link): ?>
                <?php $_last = ($_index++ >= $_count); ?>
				<?php 
					if($customer['group_id'] == $nonAdmincustGroupId) { 
						if($_link->getLabel() == 'Manage Customers' || $_link->getLabel() == 'Canceled Orders') {
							continue;
						} else {
							if (in_array($_link->getLabel(), $featureAccess)) {
								if(in_array($_link->getLabel(), $custFeatureAccess)) {
				?>
								<?php if ($this->isActive($_link)): ?>
									<li class="active<?php echo ($_last ? ' last' : '') ?>"><a href="<?php echo $_link->getUrl() ?>"><?php echo $_link->getLabel() ?></a></li>
								<?php else: ?>
									<li<?php echo ($_last ? ' class="last"' : '') ?>><a href="<?php echo $_link->getUrl() ?>"><?php echo $_link->getLabel() ?></a></li>
								<?php endif; ?>
				<?php				
								} else {
									continue;
								}
							} else {							
				?>
						<?php if ($this->isActive($_link)): ?>
							<li class="active<?php echo ($_last ? ' last' : '') ?>"><a href="<?php echo $_link->getUrl() ?>"><?php echo $_link->getLabel() ?></a></li>
						<?php else: ?>
							<li<?php echo ($_last ? ' class="last"' : '') ?>><a href="<?php echo $_link->getUrl() ?>"><?php echo $_link->getLabel() ?></a></li>
						<?php endif; ?>
						<?php } ?>
				<?php
						}						
					} else {
				?>
						<?php if ($this->isActive($_link)): ?>
							<li class="active<?php echo ($_last ? ' last' : '') ?>"><a href="<?php echo $_link->getUrl() ?>"><?php echo $_link->getLabel() ?></a></li>
						<?php else: ?>
							<li<?php echo ($_last ? ' class="last"' : '') ?>><a href="<?php echo $_link->getUrl() ?>"><?php echo $_link->getLabel() ?></a></li>
						<?php endif; ?>
				<?php	
					
					}				
				?>
                
            <?php endforeach; ?>
        </ul>
    </div>
</div>
